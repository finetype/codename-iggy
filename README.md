[![Stories in Ready](https://badge.waffle.io/undefined-NaN/codename-iggy.png?label=ready&title=Ready)](https://waffle.io/undefined-NaN/codename-iggy)
# codename-iggy

#mind:seal

BackEnd: MongoDB
model- /server/models/userData.js
db test and setup- test-data.js
Refer to the above test file to look at sample data being sent from the client side to the backend and play with the native driver queries to the mongo database.


#The Mithril Parts

##index.html
The logic flow starts at index.html. In mithril, the browser
just loads a large collection of environment variables to start with.
None of these variables in these scripts are drawn on the screen until 
they are mounted by m.routes, in routes.js, which is the last file 
loaded.

Other than bootstrap and framework dependencies, the focus for a 
developer should be on the script tags in the body.

##storageGetSet.js
This file sets some basic functions that allow us to interact with
localStorage. It's also a kind of 'helper' file. 

##devMode.js
This file is for developers only! It sets some basic data into local 
storage for you to manipulate (dummy decks, some sane default values, 
etc.). It prints instructions on its use to the console.log, and will 
alert you before it runs. You can turn it off by setting 'var devMode = 
false' on line 41 in index.html.

NOTE: you cannot run inline scripts in chrome extensions, so you will 
have to put this variable into the storageGetSet or devMode file if 
you want these set while working on a chrome extension and haven't 
loaded them into your local storage already in a way that is accessible 
to the extension.

##app.js
This is the first Mithril module. Mithril modules are objects that
contain a view property and an optional controller property, which are 
both loaded by Mithril's m.route at the appropriate time.

##Deck.js
This is the Deck model. These models are a little messy. Essentially,
they contain object templates, and server calls. This is also true for 
the next file,

##Card.js
Notice in particular Card.vm. When a new card is generated elsewhere, 
it is generated by calling this constructor. It allows any values to be 
passed in to allow flexible expansion, but in practice only expects an
object with a "front" and "back" property.

##Components
All the rest, other than router.js (and then bootstrap's files), are
components--view and controllers and variables for each view.

##newDeck.js 
This is the component for the "New Deck" page, which you get routed to
by clicked the "New Deck" button on the "home" (default) page.

##deckDash.js
This is the component that is loaded when you click a deck's button  
on the 'home' screen (the default landing page). Notice that the 
controller gets passed an object that contains variables that are
assigned and then utilized by the view. These variables are passed
from the routes.js m.route() call. 

##addCards.js
This is the page that is reached by clicking on 'add cards' from any
deck's dash. It also is passed in variables that let it know which deck
you want it to be adding to.

##settings.js
This is the component for the settings page. It has one settings set up
as a proof of concept. It modifies a variable in the model by calling
a model function designed for that purpose. That model function also
writes that changed settings to the App.mindSeal() object, and then
uses the mindSealSet() function to set it to local storage. If more
settings are added, they should probably follow this model.

##about.js
Not much to this page. 

##viewDeck.js
This is the most complicated page, and it has problems. Ideally, it 
would be rewritten, as the bugs it experiences (see below) are likely a 
result of it not being written in a way mithril expects.

It has params passed in by the router, as is common. And then notice 
that the controller is passed in as a parameter/argument to the view 
when the view is called (Mithril always calls the controller before it
calls the view). 

The chain of functions is a little complex to show and hide pieces of
the page. When the "show" button is pressed, a function is run that
sets a variable to rendered DOM elements, and toggles a boolean. That 
same function will be called again when one of the newly displayed 
buttons is pressed, but will hide, instead of show, the back of the 
next card, based on that boolean--and then toggle it again.

There is a 'next card' function that gets run every other time, 
and it also handles deciding if there are any more cards to display.
If there aren't any more cards, it will show & assign a variable in the 
view to DOM elements for 'completed'. A critical feature would be
very simple here: add in a condition that checks if that card's 
'to be seen' property indicates a date that has not yet passed, 
and respond accordingly. First, though, the 'rate' function should
be tweaked to set those dates correctly.

known bugs:

moment.js stuff used to work, but stopped working after updating the 
card viewmodel and using it. I never got around to restoring that 
functionality. That means the view will always show every card in a deck.

Also, for some reason, when viewing a deck, then going back to home,
selecting a new deck, and then viewing it--but only sometimes--you
will have to refresh to get the card to show.

This same effect is produced after adding new cards. You will see an
empty card; if that happens, refreshing the page then shows the card.

##home.js
The default component. Renders a DOM element button for every deck, puts 
them in an array, and then sets that array to a variable that is loaded
in the view.

##routes.js
this is where components get mounted. Take some time to do some reading
here to understand the flow of information. Notice that Mithril will
load a view and controller, will load the controller first, and will
allow the output of the controller being called/constructed to be passed
in to the view being called here as an argument.

-----

##About localStorage
This application is designed to function offline, as a chrome extension
or an electron app. As such, it stores all decks to localStorage, not just
to a server database or to the window object. localStorage is a persistent
5 (10?) mb space given to websites to keep information that survives 
session destruction and page refreshes. If actually made into a chrome extension,
it should actually use a special implementation of localStorage for extensions
that has much larger space allowances and wider permissions because of 
the explicit approval of the user to have installed it in the first place.

###Structure of localStorage
See storageGetSet.js, app.js and devMode.js files.
-there is a localStorage.mindSeal object that contains all of a user's mindseal info. 
-on every initialization, there is a window.App.mindSeal object that is created that
is a direct clone of that localStorage.mindSeal object. 
-after doing that, the app should then do a database call to check whether the 
localStorage data is behind the remote data, and if either is behind, sync the 
appropriate copy of data (either update server or update local, or do nothing if same).
^this functionality is not performed yet, I believe...


##Other future development:
The advanced algorithm would adjust the cScale on a particular card to be
more or less agressive based on their responses, essentially making the
scale self correcting. This shouldn't be too hard to implement, and would 
go in viewDeck's rate function.

1. basic functionality
  -add dates correctly | 8 hours
  -add date detection  | 2 hours
  DONE! -fix 'refresh' bug   | ??? 6 hours?




2. deck sharing functionality 
  -query/show shared decks (full stack) 8-12 hrs
  -add deck to shared decks (full stack) 4 hours

3. d3 in dashboards
  -6 hours basic implementation
  -6 hours refining
  -6 hours polishing?

  -main dash:
    -overall usage patterns at top
    -mini graph next to each deck button regarding deck
      -maybe showing average urgency, card age, deck review freq?
  -deck dash:
    -
  deck review:
    -colored bar representing cards need to be viewed, cards known, age of cards, etc.

4. hotkeys
  -up (prev screen state), enter(add card, deck), spacebar for showback
  -0,1,2,3 for rating
  -2-4 hours?

9. machine learning algorithm upgrades
  -auto adjust users' own defaults
  -anonymous usage stats -> baseline newuser default adjustment




5. import/export from anki
  -4-8 hours?

6. flesh out the settings page
  -6hrs

7. wysiwig cards
  -???

8. deck editor screen
  -lots more d3 deck stats could go here that would be distracting


VISUALS. 
  -several days
  -make pretty with materialize 
  -animating with velocity.js
  -left-side menu bar
  -card animations
  -smooth page transitions
  -prettier text entry boxes

OTHER.
  -electron deploy
  -mobile package deploy
  -react mobile app deploy
  -chrome extension deploy
    -nice chrome popup

  -write tests
  -more documentation
  -owner dashboard
  -undo button